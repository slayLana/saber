{"remainingRequest":"/Users/jiang/WorkSpace/bladex/saber/node_modules/babel-loader/lib/index.js!/Users/jiang/WorkSpace/bladex/saber/node_modules/eslint-loader/index.js??ref--13-0!/Users/jiang/WorkSpace/bladex/saber/src/permission.js","dependencies":[{"path":"/Users/jiang/WorkSpace/bladex/saber/src/permission.js","mtime":1666151205528},{"path":"/Users/jiang/WorkSpace/bladex/saber/babel.config.js","mtime":1666151205448},{"path":"/Users/jiang/WorkSpace/bladex/saber/node_modules/cache-loader/dist/cjs.js","mtime":1666157453018},{"path":"/Users/jiang/WorkSpace/bladex/saber/node_modules/babel-loader/lib/index.js","mtime":1666157453268},{"path":"/Users/jiang/WorkSpace/bladex/saber/node_modules/eslint-loader/index.js","mtime":1666157452476}],"contextDependencies":[],"result":["import \"core-js/modules/es6.function.name\";\n\n/**\n * 全站权限配置\n *\n */\nimport router from \"./router/router\";\nimport store from \"./store\";\nimport { validatenull } from '@/util/validate';\nimport { getToken } from '@/util/auth';\nimport NProgress from 'nprogress'; // progress bar\n\nimport 'nprogress/nprogress.css'; // progress bar style\n\nNProgress.configure({\n  showSpinner: false\n});\nvar lockPage = store.getters.website.lockPage; //锁屏页\n\nrouter.beforeEach(function (to, from, next) {\n  var meta = to.meta || {};\n  var isMenu = meta.menu === undefined ? to.query.menu : meta.menu;\n  store.commit('SET_IS_MENU', isMenu === undefined);\n\n  if (getToken()) {\n    if (store.getters.isLock && to.path !== lockPage) {\n      //如果系统激活锁屏，全部跳转到锁屏页\n      next({\n        path: lockPage\n      });\n    } else if (to.path === '/login') {\n      //如果登录成功访问登录页跳转到主页\n      next({\n        path: '/'\n      });\n    } else {\n      //如果用户信息为空则获取用户信息，获取用户信息失败，跳转到登录页\n      if (store.getters.token.length === 0) {\n        store.dispatch('FedLogOut').then(function () {\n          next({\n            path: '/login'\n          });\n        });\n      } else {\n        var value = to.query.src || to.fullPath;\n        var label = to.query.name || to.name;\n\n        var _meta = to.meta || router.$avueRouter.meta || {};\n\n        var i18n = to.query.i18n;\n\n        if (to.query.target) {\n          window.open(value);\n        } else if (_meta.isTab !== false && !validatenull(value) && !validatenull(label)) {\n          store.commit('ADD_TAG', {\n            label: label,\n            value: value,\n            params: to.params,\n            query: to.query,\n            meta: function () {\n              if (!i18n) {\n                return _meta;\n              }\n\n              return {\n                i18n: i18n\n              };\n            }(),\n            group: router.$avueRouter.group || []\n          });\n        }\n\n        next();\n      }\n    }\n  } else {\n    //判断是否需要认证，没有登录访问去登录页\n    if (meta.isAuth === false) {\n      next();\n    } else {\n      next('/login');\n    }\n  }\n});\nrouter.afterEach(function () {\n  NProgress.done();\n  var title = store.getters.tag.label;\n  var i18n = store.getters.tag.meta.i18n;\n  title = router.$avueRouter.generateTitle(title, i18n); //判断登录页的情况\n\n  if (router.history.current.fullPath === \"/login\") {\n    title = \"登录\";\n  } //根据当前的标签也获取label的值动态设置浏览器标题\n\n\n  router.$avueRouter.setTitle(title);\n});",{"version":3,"names":["router","store","validatenull","getToken","NProgress","configure","showSpinner","lockPage","getters","website","beforeEach","to","from","next","meta","isMenu","menu","undefined","query","commit","isLock","path","token","length","dispatch","then","value","src","fullPath","label","name","$avueRouter","i18n","target","window","open","isTab","params","group","isAuth","afterEach","done","title","tag","generateTitle","history","current","setTitle"],"sources":["/Users/jiang/WorkSpace/bladex/saber/src/permission.js"],"sourcesContent":["/**\n * 全站权限配置\n *\n */\nimport router from './router/router'\nimport store from './store'\nimport {validatenull} from '@/util/validate'\nimport {getToken} from '@/util/auth'\nimport NProgress from 'nprogress' // progress bar\nimport 'nprogress/nprogress.css' // progress bar style\nNProgress.configure({showSpinner: false});\nconst lockPage = store.getters.website.lockPage; //锁屏页\nrouter.beforeEach((to, from, next) => {\n  const meta = to.meta || {};\n  const isMenu = meta.menu === undefined ? to.query.menu : meta.menu;\n  store.commit('SET_IS_MENU', isMenu === undefined);\n  if (getToken()) {\n    if (store.getters.isLock && to.path !== lockPage) { //如果系统激活锁屏，全部跳转到锁屏页\n      next({path: lockPage})\n    } else if (to.path === '/login') { //如果登录成功访问登录页跳转到主页\n      next({path: '/'})\n    } else {\n      //如果用户信息为空则获取用户信息，获取用户信息失败，跳转到登录页\n      if (store.getters.token.length === 0) {\n        store.dispatch('FedLogOut').then(() => {\n          next({path: '/login'})\n        })\n      } else {\n        const value = to.query.src || to.fullPath;\n        const label = to.query.name || to.name;\n        const meta = to.meta || router.$avueRouter.meta || {};\n        const i18n = to.query.i18n;\n        if (to.query.target) {\n          window.open(value)\n        } else if (meta.isTab !== false && !validatenull(value) && !validatenull(label)) {\n          store.commit('ADD_TAG', {\n            label: label,\n            value: value,\n            params: to.params,\n            query: to.query,\n            meta: (() => {\n              if (!i18n) {\n                return meta\n              }\n              return {\n                i18n: i18n\n              }\n            })(),\n            group: router.$avueRouter.group || []\n          });\n        }\n        next()\n      }\n    }\n  } else {\n    //判断是否需要认证，没有登录访问去登录页\n    if (meta.isAuth === false) {\n      next()\n    } else {\n      next('/login')\n    }\n  }\n})\n\nrouter.afterEach(() => {\n  NProgress.done();\n  let title = store.getters.tag.label;\n  let i18n = store.getters.tag.meta.i18n;\n  title = router.$avueRouter.generateTitle(title, i18n);\n  //判断登录页的情况\n  if (router.history.current.fullPath === \"/login\") {\n    title = \"登录\";\n  }\n  //根据当前的标签也获取label的值动态设置浏览器标题\n  router.$avueRouter.setTitle(title);\n});\n"],"mappings":"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"}]}