{"remainingRequest":"/Users/jiang/WorkSpace/code/bladex/saber/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/jiang/WorkSpace/code/bladex/saber/src/views/warehousingEntry/warehousingEntry.vue?vue&type=style&index=0&id=19657376&lang=scss&scoped=true&","dependencies":[{"path":"/Users/jiang/WorkSpace/code/bladex/saber/src/views/warehousingEntry/warehousingEntry.vue","mtime":1668865005787},{"path":"/Users/jiang/WorkSpace/code/bladex/saber/node_modules/css-loader/index.js","mtime":1666157452306},{"path":"/Users/jiang/WorkSpace/code/bladex/saber/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1666157454418},{"path":"/Users/jiang/WorkSpace/code/bladex/saber/node_modules/postcss-loader/src/index.js","mtime":1666157453259},{"path":"/Users/jiang/WorkSpace/code/bladex/saber/node_modules/sass-loader/dist/cjs.js","mtime":1666157452322},{"path":"/Users/jiang/WorkSpace/code/bladex/saber/node_modules/cache-loader/dist/cjs.js","mtime":1666157453018},{"path":"/Users/jiang/WorkSpace/code/bladex/saber/node_modules/vue-loader/lib/index.js","mtime":1666157454301}],"contextDependencies":[],"result":["\n.el-pagination {\n  margin-top: 20px;\n}\n.upload {\n  display: inline-block;\n}\n",{"version":3,"sources":["warehousingEntry.vue"],"names":[],"mappings":";AAqlBA;AACA;AACA;AACA;AACA;AACA","file":"warehousingEntry.vue","sourceRoot":"src/views/warehousingEntry","sourcesContent":["<template>\n  <basic-container v-loading=\"fullscreenLoading\">\n    <div class=\"avue-crud\">\n      <el-row :hidden=\"!search\" style=\"padding: 5px\">\n        <!-- 查询模块 -->\n        <el-form :inline=\"true\" :size=\"option.size\" :model=\"query\">\n          <template>\n            <el-form-item label=\"货品ID\">\n              <el-input v-model=\"query.skuId\" placeholder=\"请输入货品ID\"></el-input>\n            </el-form-item>\n            <el-form-item label=\"产商\">\n              <el-input v-model=\"query.business\" placeholder=\"请输入产商\"></el-input>\n            </el-form-item>\n            <el-form-item label=\"商品\">\n              <el-input v-model=\"query.goodsName\" placeholder=\"请输入商品名称\"></el-input>\n            </el-form-item>\n            <el-form-item label=\"颜色规格\">\n              <el-input v-model=\"query.goodsName\" placeholder=\"请输入颜色规格\"></el-input>\n            </el-form-item>\n            <el-form-item label=\"操作状态\">\n              <el-select\n              v-model=\"query.operate\"\n                clearable\n                multiple\n                placeholder=\"请选择\"\n              >\n              <el-option\n                  :key=\"1\"\n                  label=\"入库\"\n                  :value=\"1\"\n                >\n                </el-option>\n                <el-option\n                  :key=\"0\"\n                  label=\"出库\"\n                  :value=\"0\"\n                >\n                </el-option>\n              </el-select>\n            </el-form-item>\n            <el-form-item label=\"下单日期\">\n              <el-date-picker\n              type=\"daterange\"\n              format=\"yyyy-MM-dd\"\n              value-format=\"yyyy-MM-dd\"\n      v-model=\"query.orderDateRange\"\n      placeholder=\"选择日期\">\n    </el-date-picker>\n            </el-form-item>\n          </template>\n          <!-- 查询按钮 -->\n          <el-form-item>\n            <el-button\n              type=\"primary\"\n              icon=\"el-icon-search\"\n              @click=\"searchChange\"\n              >搜索</el-button\n            >\n            <el-button icon=\"el-icon-delete\" @click=\"searchReset()\"\n              >清空</el-button\n            >\n          </el-form-item>\n        </el-form>\n      </el-row>\n      <el-row>\n        <div class=\"avue-crud__menu\">\n          <!-- 头部左侧按钮模块 -->\n          <div class=\"avue-crud__left\">\n            <el-button\n              :size=\"option.size\"\n              type=\"primary\"\n              icon=\"el-icon-plus\"\n              @click=\"handleAdd\"\n              >新增</el-button\n            >\n            <el-button\n              :size=\"option.size\"\n              type=\"danger\"\n              icon=\"el-icon-delete\"\n              @click=\"handleDelete\"\n              plain\n              >删除\n            </el-button>\n             <el-dropdown >\n  <el-button type=\"primary\" :size=\"option.size\">\n    导入<i class=\"el-icon-arrow-down el-icon--right\"></i>\n  </el-button>\n  <el-dropdown-menu slot=\"dropdown\" >\n    <el-dropdown-item ><el-upload\n              class=\"upload\"\n              :headers=\"headers\"\n              action=\"/api/blade-warehousingEntry/warehousingEntry/import-excel?operate=1\"\n              multiple\n              ref=\"upload1\"\n              :show-file-list=\"false\"\n              :limit=\"1\"\n              :on-success=\"handleSuccess\"\n              :before-upload=\"hadleUpload\"\n            >\n              入库单\n            </el-upload></el-dropdown-item>\n            <el-dropdown-item >\n            <el-upload\n              class=\"upload\"\n              :headers=\"headers\"\n              action=\"/api/blade-warehousingEntry/warehousingEntry/import-excel?operate=0\"\n              multiple\n              ref=\"upload2\"\n              :show-file-list=\"false\"\n              :limit=\"1\"\n              :on-success=\"handleSuccess\"\n              :before-upload=\"hadleUpload\"\n            >出库单\n            </el-upload></el-dropdown-item>\n  </el-dropdown-menu>\n</el-dropdown>\n            <!-- <el-upload\n              class=\"upload\"\n              :headers=\"headers\"\n              action=\"/api/blade-warehousingEntry/warehousingEntry/import-excel?operate=1\"\n              multiple\n              ref=\"upload\"\n              :show-file-list=\"false\"\n              :limit=\"1\"\n              :on-success=\"handleSuccess\"\n              :before-upload=\"hadleUpload\"\n            >\n              <el-button :size=\"option.size\" type=\"primary\" \n                >导入入库单</el-button\n              >\n            </el-upload> -->\n            <el-dropdown @command=\"clickMenu\">\n  <el-button type=\"primary\" :size=\"option.size\">\n    导出<i class=\"el-icon-arrow-down el-icon--right\"></i>\n  </el-button>\n  <el-dropdown-menu slot=\"dropdown\" >\n    <el-dropdown-item :command=\"handleExport\">入库单数据</el-dropdown-item>\n    <el-dropdown-item :command=\"exportInTemp\">入库单模板</el-dropdown-item>\n    <el-dropdown-item :command=\"exportOutTemp\">出库单模板</el-dropdown-item>\n  </el-dropdown-menu>\n</el-dropdown>\n          </div>\n          <!-- 头部右侧按钮模块 -->\n          <div class=\"avue-crud__right\">\n            <el-button\n              :size=\"option.size\"\n              icon=\"el-icon-refresh\"\n              @click=\"searchChange\"\n              circle\n            ></el-button>\n            <el-button\n              :size=\"option.size\"\n              icon=\"el-icon-search\"\n              @click=\"searchHide\"\n              circle\n            ></el-button>\n          </div>\n        </div>\n      </el-row>\n      <el-row>\n        <!-- 列表模块 -->\n        <el-table\n          ref=\"table\"\n          v-loading=\"loading\"\n          :size=\"option.size\"\n          @selection-change=\"selectionChange\"\n          :data=\"data\"\n          style=\"width: 100%\"\n          :border=\"option.border\"\n        >\n          <el-table-column\n            type=\"selection\"\n            v-if=\"option.selection\"\n            width=\"55\"\n            align=\"center\"\n          ></el-table-column>\n          <el-table-column\n            type=\"expand\"\n            v-if=\"option.expand\"\n            align=\"center\"\n          ></el-table-column>\n          <template v-for=\"(item, index) in option.column\">\n            <!-- table字段 -->\n            <el-table-column\n              v-if=\"item.hide !== true\"\n              :prop=\"item.prop\"\n              :label=\"item.label\"\n              :width=\"item.width\"\n              :showOverflowTooltip=\"item.showOverflowTooltip\"\n              :key=\"index\"\n            >\n              <template slot-scope=\"{ row }\">\n                <template v-if=\"item.prop == 'operate'\">\n                  <el-tag type=\"success\" v-if=\"row.operate == 1\">入库</el-tag>\n                  <el-tag type=\"warning\" v-if=\"row.operate == 0\">出库</el-tag>\n                </template>\n                <template v-else>{{ row[item.prop] }}</template>\n              </template>\n            </el-table-column>\n          </template>\n          <!-- 操作栏模块 -->\n          <el-table-column prop=\"menu\" label=\"操作\" :width=\"180\" align=\"center\">\n            <template slot-scope=\"{ row }\">\n              <el-button\n                :size=\"option.size\"\n                type=\"text\"\n                icon=\"el-icon-edit\"\n                @click=\"handleEdit(row)\"\n                >编辑</el-button\n              >\n              <el-button\n                :size=\"option.size\"\n                type=\"text\"\n                icon=\"el-icon-delete\"\n                @click=\"rowDel(row)\"\n                >删除</el-button\n              >\n            </template>\n          </el-table-column>\n        </el-table>\n      </el-row>\n      <el-row>\n        <!-- 分页模块 -->\n        <el-pagination\n          align=\"right\"\n          background\n          @size-change=\"sizeChange\"\n          @current-change=\"currentChange\"\n          :current-page=\"page.currentPage\"\n          :page-sizes=\"[10, 20, 30, 40, 50, 100]\"\n          :page-size=\"page.pageSize\"\n          layout=\"total, sizes, prev, pager, next, jumper\"\n          :total=\"page.total\"\n        >\n        </el-pagination>\n      </el-row>\n      <!-- 表单模块 -->\n      <el-dialog\n        :title=\"title\"\n        :visible.sync=\"box\"\n        width=\"50%\"\n        :before-close=\"beforeClose\"\n        append-to-body\n      >\n        <el-form\n          :disabled=\"view\"\n          :size=\"option.size\"\n          ref=\"form\"\n          :model=\"form\"\n          label-width=\"80px\"\n        >\n          <!-- 表单字段 -->\n          <el-form-item label=\"下单日期\" prop=\"orderDate\">\n            <!-- <el-input v-model=\"form.orderDate\" placeholder=\"请输入提报日期\" /> -->\n            <el-date-picker\n      v-model=\"form.orderDate\"\n      format=\"yyyy-MM-dd\"\n      value-format=\"yyyy-MM-dd\"\n      type=\"date\"\n\n      placeholder=\"选择日期\">\n    </el-date-picker>\n          </el-form-item>\n          <el-form-item label=\"货品Id\" prop=\"skuId\">\n            <el-input v-model=\"form.skuId\" placeholder=\"请输入货品Id\" @change=\"getGoodsInfo\"/>\n          </el-form-item>\n          <el-form-item label=\"产商\" prop=\"business\">\n            <el-input v-model=\"form.business\" placeholder=\"请输入产商\" disabled/>\n          </el-form-item>\n          <el-form-item label=\"货品条码\" prop=\"goodsCode\">\n            <el-input v-model=\"form.goodsCode\" placeholder=\"请输入条码\" disabled/>\n          </el-form-item>\n          <el-form-item label=\"商品名称\" prop=\"goodsName\">\n            <el-input v-model=\"form.goodsName\" placeholder=\"请输入商品名称\" disabled/>\n          </el-form-item>\n          <el-form-item label=\"颜色规格\" prop=\"goodsColor\">\n            <el-input v-model=\"form.goodsColor\" placeholder=\"请输入颜色规格\" disabled/>\n          </el-form-item>\n          <el-form-item label=\"克重\" prop=\"goodsWeightK\">\n            <el-input v-model=\"form.goodsWeightK\" placeholder=\"请输入克重\" disabled/>\n          </el-form-item>\n          <el-form-item label=\"单位\" prop=\"unit\">\n            <el-input v-model=\"form.unit\" placeholder=\"请输入单位\" />\n          </el-form-item>\n          <el-form-item label=\"单价\" prop=\"goodsPrice\">\n            <el-input v-model=\"form.goodsPrice\" placeholder=\"请输入单价\" />\n          </el-form-item>\n          <el-form-item label=\"补货量\" prop=\"goodsNumber\">\n            <el-input v-model=\"form.goodsNumber\" placeholder=\"请输入补货量\" />\n          </el-form-item>\n          <el-form-item label=\"总价\" prop=\"totalPrice\">\n            <el-input v-model=\"form.totalPrice\" placeholder=\"请输入总价\" disabled/>\n          </el-form-item>\n          <el-form-item label=\"到货/出货时间\" prop=\"arrivalDate\">\n            <!-- <el-input v-model=\"form.arrivalDate\" placeholder=\"预计到货时间\" /> -->\n            <el-date-picker\n      v-model=\"form.arrivalDate\"\n      format=\"yyyy-MM-dd\"\n      value-format=\"yyyy-MM-dd\"\n      type=\"date\"\n\n      placeholder=\"选择日期\"></el-date-picker>\n          </el-form-item>\n          <el-form-item label=\"操作\" prop=\"remark\">\n            <!-- <el-input v-model=\"form.remark\" placeholder=\"请输入备注\" /> -->\n                <el-radio-group v-model=\"form.operate\" >\n                  <el-radio :label=\"1\" >入库</el-radio>\n                  <el-radio :label=\"0\" >出库</el-radio>\n                </el-radio-group>\n          </el-form-item>\n          <el-form-item label=\"备注\" prop=\"remark\">\n            <el-input v-model=\"form.remark\" placeholder=\"请输入备注\" />\n          </el-form-item>\n          \n        </el-form>\n        <!-- 表单按钮 -->\n        <span v-if=\"!view\" slot=\"footer\" class=\"dialog-footer\">\n          <el-button\n            type=\"primary\"\n            icon=\"el-icon-circle-check\"\n            :size=\"option.size\"\n            @click=\"handleSubmit\"\n            >提 交</el-button\n          >\n          <el-button\n            icon=\"el-icon-circle-close\"\n            :size=\"option.size\"\n            @click=\"box = false\"\n            >取 消</el-button\n          >\n        </span>\n      </el-dialog>\n    </div>\n  </basic-container>\n</template>\n\n<script>\nimport {\n  getList,\n  getDetail,\n  getGoodsInfo,\n  add,\n  update,\n  remove,\n} from \"@/api/warehousingEntry/warehousingEntry\";\nimport option from \"@/const/warehousingEntry/warehousingEntry\";\nimport { mapGetters } from \"vuex\";\nimport store from \"../../store\";\n  import {exportBlob} from \"@/api/common\";\n  import {getToken} from \"@/util/auth\";\n  import NProgress from 'nprogress';\n  import 'nprogress/nprogress.css';\n  import { downloadXls, timeFormate } from \"@/util/util\";\n\nexport default {\n  data() {\n    return {\n      fullscreenLoading: false,\n      headers: {\n        \"Blade-Auth\": \"Bearer \" + store.getters.token,\n      },\n      // 弹框标题\n      title: \"\",\n      // 是否展示弹框\n      box: false,\n      // 是否显示查询\n      search: true,\n      // 加载中\n      loading: true,\n      // 是否为查看模式\n      view: false,\n      // 查询信息\n      query: {},\n      // 分页信息\n      page: {\n        currentPage: 1,\n        pageSize: 10,\n        total: 40,\n      },\n      \n      // 表单数据\n      form: {},\n      // 选择行\n      selectionList: [],\n      // 表单配置\n      option: option,\n      // 表单列表\n      data: [],\n    };\n  },\n  mounted() {\n    this.init();\n    this.onLoad(this.page);\n  },\n  watch:{\n    totalPrice(){\n      this.form.totalPrice = this.totalPrice\n    }\n  },\n  computed: {\n    ...mapGetters([\"permission\"]),\n    ids() {\n      let ids = [];\n      this.selectionList.forEach((ele) => {\n        ids.push(ele.id);\n      });\n      return ids.join(\",\");\n    },\n    totalPrice(){\n      return (this.form.goodsNumber * this.form.goodsPrice).toFixed(2) || 0;\n    }\n  },\n  methods: {\n    init() {},\n    searchHide() {\n      this.search = !this.search;\n    },\n    getGoodsInfo(id){\n      if(id.length == 6){\n        getGoodsInfo(id).then( res =>{\n          const tmp = {\n            business:res.data.data.business,\n            goodsCode:res.data.data.goodsCode,\n            goodsName:res.data.data.goodsName,\n            goodsColor:res.data.data.goodsColor,\n            goodsWeightK:res.data.data.goodsWeightK\n          }\n          this.form = {...this.form,...tmp};\n        })\n      }\n    },\n    clickMenu(f){\n      f()\n    },\n    exportInTemp(){\n       exportBlob(`/api/blade-warehousingEntry/warehousingEntry/export-temp?op=1&${this.website.tokenHeader}=${getToken()}`,1).then(res => {\n             downloadXls(res.data, `入库单模板.xlsx`);\n          })\n    },\n    exportOutTemp(){\n       exportBlob(`/api/blade-warehousingEntry/warehousingEntry/export-temp?op=0&${this.website.tokenHeader}=${getToken()}`,0).then(res => {\n            downloadXls(res.data, `出库单模板.xlsx`)\n          })\n    },\n    handleExport() {\n        this.$confirm(\"是否导出入库单数据?\", \"提示\", {\n          confirmButtonText: \"确定\",\n          cancelButtonText: \"取消\",\n          type: \"warning\"\n        }).then(() => {\n          NProgress.start();\n          exportBlob(`/api/blade-warehousingEntry/warehousingEntry/export-data?${this.website.tokenHeader}=${getToken()}`,this.query).then(res => {\n            downloadXls(res.data, `入库单${timeFormate(new Date())}.xlsx`);\n            NProgress.done();\n          })\n        });\n      },\n    searchChange() {\n      this.onLoad(this.page);\n    },\n    searchReset() {\n      this.query = {};\n      this.page.currentPage = 1;\n      this.onLoad(this.page);\n    },\n    handleSubmit() {\n      if (!this.form.id) {\n        add(this.form).then(() => {\n          this.box = false;\n          this.onLoad(this.page);\n          this.$message({\n            type: \"success\",\n            message: \"操作成功!\",\n          });\n        });\n      } else {\n        update(this.form).then(() => {\n          this.box = false;\n          this.onLoad(this.page);\n          this.$message({\n            type: \"success\",\n            message: \"操作成功!\",\n          });\n        });\n      }\n    },\n    handleAdd() {\n      this.title = \"新增\";\n      this.form = {};\n      this.box = true;\n    },\n    handleEdit(row) {\n      this.title = \"编辑\";\n      this.box = true;\n      getDetail(row.id).then((res) => {\n        this.form = res.data.data;\n      });\n    },\n    handleView(row) {\n      this.title = \"查看\";\n      this.view = true;\n      this.box = true;\n      getDetail(row.id).then((res) => {\n        this.form = res.data.data;\n      });\n    },\n    handleDelete() {\n      if (this.selectionList.length === 0) {\n        this.$message.warning(\"请选择至少一条数据\");\n        return;\n      }\n      this.$confirm(\"确定将选择数据删除?\", {\n        confirmButtonText: \"确定\",\n        cancelButtonText: \"取消\",\n        type: \"warning\",\n      })\n        .then(() => {\n          return remove(this.ids);\n        })\n        .then(() => {\n          this.selectionClear();\n          this.onLoad(this.page);\n          this.$message({\n            type: \"success\",\n            message: \"操作成功!\",\n          });\n        });\n    },\n    rowDel(row) {\n      this.$confirm(\"确定将选择数据删除?\", {\n        confirmButtonText: \"确定\",\n        cancelButtonText: \"取消\",\n        type: \"warning\",\n      })\n        .then(() => {\n          return remove(row.id);\n        })\n        .then(() => {\n          this.onLoad(this.page);\n          this.$message({\n            type: \"success\",\n            message: \"操作成功!\",\n          });\n        });\n    },\n    beforeClose(done) {\n      done();\n      this.form = {};\n      this.view = false;\n    },\n    selectionChange(list) {\n      this.selectionList = list;\n    },\n    selectionClear() {\n      this.selectionList = [];\n      this.$refs.table.clearSelection();\n    },\n    currentChange(currentPage) {\n      this.page.currentPage = currentPage;\n      this.onLoad(this.page);\n    },\n    sizeChange(pageSize) {\n      this.page.pageSize = pageSize;\n      this.onLoad(this.page);\n    },\n    onLoad(page, params = {}) {\n      this.loading = true;\n      getList(\n        page.currentPage,\n        page.pageSize,\n        Object.assign(params, this.query)\n      ).then((res) => {\n        const data = res.data.data;\n        this.page.total = data.total;\n        this.data = data.records;\n        this.loading = false;\n        this.selectionClear();\n      });\n    },\n    handleSuccess(res) {\n      this.$refs.upload1.clearFiles();\n      this.$refs.upload2.clearFiles();\n      this.$message({\n        message: res.msg,\n        type: \"success\",\n      });\n      this.fullscreenLoading = false;\n      this.onLoad(this.page);\n    },\n    hadleUpload() {\n      this.fullscreenLoading = true;\n    },\n  },\n};\n</script>\n\n<style lang=\"scss\" scoped>\n.el-pagination {\n  margin-top: 20px;\n}\n.upload {\n  display: inline-block;\n}\n</style>\n"]}]}