{"remainingRequest":"/Users/jiang/WorkSpace/bladex/saber/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/jiang/WorkSpace/bladex/saber/src/views/goodsInfo/goodsInfo.vue?vue&type=style&index=0&id=cdd02162&lang=scss&scoped=true&","dependencies":[{"path":"/Users/jiang/WorkSpace/bladex/saber/src/views/goodsInfo/goodsInfo.vue","mtime":1666191990130},{"path":"/Users/jiang/WorkSpace/bladex/saber/node_modules/css-loader/index.js","mtime":1666157452306},{"path":"/Users/jiang/WorkSpace/bladex/saber/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1666157454418},{"path":"/Users/jiang/WorkSpace/bladex/saber/node_modules/postcss-loader/src/index.js","mtime":1666157453259},{"path":"/Users/jiang/WorkSpace/bladex/saber/node_modules/sass-loader/dist/cjs.js","mtime":1666157452322},{"path":"/Users/jiang/WorkSpace/bladex/saber/node_modules/cache-loader/dist/cjs.js","mtime":1666157453018},{"path":"/Users/jiang/WorkSpace/bladex/saber/node_modules/vue-loader/lib/index.js","mtime":1666157454301}],"contextDependencies":[],"result":["\n.el-pagination {\n  margin-top: 20px;\n}\n.avatar-uploader .el-upload {\n  border: 1px dashed #d9d9d9;\n  border-radius: 6px;\n  cursor: pointer;\n  position: relative;\n  overflow: hidden;\n}\n.avatar-uploader .el-upload:hover {\n  border-color: #409eff;\n}\n.avatar-uploader-icon {\n  font-size: 28px;\n  color: #8c939d;\n  text-align: center;\n}\n.avatar {\n  display: block;\n}\n",{"version":3,"sources":["goodsInfo.vue"],"names":[],"mappings":";AAgtCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"goodsInfo.vue","sourceRoot":"src/views/goodsInfo","sourcesContent":["<template>\n  <basic-container>\n    <div class=\"avue-crud\">\n      <el-row :hidden=\"!search\" style=\"padding: 5px\">\n        <!-- 查询模块 -->\n        <el-form :inline=\"true\" :size=\"option.size\" :model=\"query\">\n          <template>\n            <el-form-item label=\"提报日期\">\n              <el-date-picker\n                v-model=\"query.submissionDateStr\"\n                format=\"yyyy-MM-dd\"\n                value-format=\"yyyy-MM-dd\"\n                type=\"date\"\n                placeholder=\"选择日期\"\n              ></el-date-picker>\n            </el-form-item>\n            <el-form-item label=\"进度\" prop=\"business\">\n              <el-select\n                v-model=\"query.goodsRate\"\n                clearable\n                placeholder=\"请选择\"\n              >\n                <el-option\n                  v-for=\"item in rateOptions\"\n                  :key=\"item.value\"\n                  :label=\"item.label\"\n                  :value=\"item.value\"\n                >\n                </el-option>\n              </el-select>\n            </el-form-item>\n            <el-form-item label=\"产商\">\n              <el-input\n                v-model=\"query.business\"\n                placeholder=\"请输入产商\"\n              ></el-input>\n            </el-form-item>\n            <el-form-item label=\"商品\">\n              <el-input\n                v-model=\"query.goodsName\"\n                placeholder=\"请输入商品名称\"\n              ></el-input>\n            </el-form-item>\n            <el-form-item label=\"发货地\">\n              <el-input\n                v-model=\"query.placeDeliver\"\n                placeholder=\"请输入发货地\"\n              ></el-input>\n            </el-form-item>\n            <el-form-item label=\"条码\">\n              <el-input\n                v-model=\"query.goodsCode\"\n                placeholder=\"请输入条码\"\n              ></el-input>\n            </el-form-item>\n          </template>\n          <!-- 查询按钮 -->\n          <el-form-item>\n            <el-button\n              type=\"primary\"\n              icon=\"el-icon-search\"\n              @click=\"searchChange\"\n              >搜索</el-button\n            >\n            <el-button icon=\"el-icon-delete\" @click=\"searchReset()\"\n              >清空</el-button\n            >\n          </el-form-item>\n        </el-form>\n      </el-row>\n      <el-row>\n        <div class=\"avue-crud__menu\">\n          <!-- 头部左侧按钮模块 -->\n          <div class=\"avue-crud__left\">\n            <el-button\n              :size=\"option.size\"\n              type=\"primary\"\n              icon=\"el-icon-plus\"\n              @click=\"handleAdd\"\n              >新增</el-button\n            >\n            <el-button\n              :size=\"option.size\"\n              type=\"danger\"\n              icon=\"el-icon-delete\"\n              @click=\"handleDelete\"\n              plain\n              >删除\n            </el-button>\n            <el-button\n              :size=\"option.size\"\n              type=\"primary\"\n              @click=\"handleImport\"\n              plain\n              >导入\n            </el-button>\n            <el-button\n              :size=\"option.size\"\n              type=\"primary\"\n              @click=\"handleExport\"\n              plain\n              >导出\n            </el-button>\n          </div>\n          <!-- 头部右侧按钮模块 -->\n          <div class=\"avue-crud__right\">\n            <el-button\n              :size=\"option.size\"\n              icon=\"el-icon-refresh\"\n              @click=\"searchChange\"\n              circle\n            ></el-button>\n            <el-button\n              :size=\"option.size\"\n              icon=\"el-icon-search\"\n              @click=\"searchHide\"\n              circle\n            ></el-button>\n          </div>\n        </div>\n      </el-row>\n      <el-row>\n        <!-- 列表模块 -->\n        <el-table\n          ref=\"table\"\n          v-loading=\"loading\"\n          :size=\"option.size\"\n          @selection-change=\"selectionChange\"\n          :data=\"data\"\n          style=\"width: 100%\"\n          :border=\"option.border\"\n          @sort-change=\"handleSort\"\n          :row-style=\"tableRowStyle\"\n        >\n          <el-table-column\n            type=\"selection\"\n            v-if=\"option.selection\"\n            width=\"55\"\n            align=\"center\"\n          ></el-table-column>\n          <el-table-column\n            type=\"expand\"\n            v-if=\"option.expand\"\n            align=\"center\"\n          ></el-table-column>\n          <template v-for=\"(item, index) in option.column\">\n            <!-- table字段 -->\n            <el-table-column\n              v-if=\"item.hide !== true\"\n              :prop=\"item.prop\"\n              :sortable=\"item.sortable\"\n              :label=\"item.label\"\n              :fixed=\"item.fixed\"\n              :width=\"item.width\"\n              :show-overflow-tooltip=\"item.showOverflowTooltip\"\n              :key=\"index\"\n              :max-height=\"5\"\n            >\n              <template slot-scope=\"{ row }\">\n                <template v-if=\"item.prop == 'goodsImage'\">\n                  <el-upload\n                    v-model=\"row.goodsImage\"\n                    :beforeUpload=\"beforeUpload\"\n                    accept=\".jpg,.jpeg,.png,\"\n                    :http-request=\"uploadImage\"\n                    :headers=\"headers\"\n                    class=\"avatar-uploader\"\n                    :show-file-list=\"false\"\n                    action=\"\"\n                  >\n                    <img\n                      v-if=\"row.goodsImage\"\n                      :src=\"row.goodsImage\"\n                      class=\"avatar\"\n                      style=\"width: 50px; height: 50px\"\n                      @click=\"bind_Id(row.id)\"\n                    />\n                    <i\n                      v-else\n                      class=\"el-icon-plus avatar-uploader-icon\"\n                      @click=\"bind_Id(row.id)\"\n                    ></i>\n                  </el-upload>\n                </template>\n                <template v-else-if=\"item.prop == 'offerPrice'\">\n                  <el-tooltip placement=\"top\">\n                    <div slot=\"content\">\n                      数量：{{ row.goodsCount }}<br />\n                      运费1：{{ row.freightFee1 }}<br />成本1：{{\n                        row.primeCost1\n                      }}<br />\n                      运费2：{{ row.freightFee2 }}<br />成本2：{{\n                        row.primeCost2\n                      }}\n                    </div>\n                    <el-button\n                      :size=\"option.size\"\n                      type=\"text\"\n                      @click=\"handleOfferPrice(row)\"\n                      >{{ row[item.prop] || 0 }}</el-button\n                    >\n                  </el-tooltip>\n                </template>\n                <template v-else>\n                  <focus-input\n                    :openEdit=\"item.edit\"\n                    v-model=\"row[item.prop]\"\n                    :placeholder=\"item.label\"\n                    :selectOptions=\"item.selectOptions || {}\"\n                    :commentOption=\"item.comment\"\n                    :datePickOptions=\"item.datePickOptions\"\n                    :mystyle=\"\n                      myFuction(item.comment ? item.comment.style : null, row)\n                    \"\n                    @myclick=\"\n                      myFuction(item.comment ? item.comment.onclick : null, row)\n                    \"\n                    @openEdit=\"openEdit(item)\"\n                    :inputType=\"item.inputType\"\n                    @myOnBlur=\"\n                      handleOnBlur(row, item, arguments[0], arguments[1])\n                    \"\n                  >\n                  </focus-input>\n                </template>\n              </template>\n            </el-table-column>\n          </template>\n          <!-- 操作栏模块 -->\n          <el-table-column prop=\"menu\" label=\"操作\" :width=\"180\" align=\"center\">\n            <template slot-scope=\"{ row }\">\n              <el-button\n                :size=\"option.size\"\n                type=\"text\"\n                icon=\"el-icon-edit\"\n                @click=\"handleEdit(row)\"\n                >编辑</el-button\n              >\n              <el-button\n                :size=\"option.size\"\n                type=\"text\"\n                icon=\"el-icon-delete\"\n                @click=\"rowDel(row)\"\n                >删除</el-button\n              >\n            </template>\n          </el-table-column>\n        </el-table>\n      </el-row>\n      <el-row>\n        <!-- 分页模块 -->\n        <el-pagination\n          align=\"right\"\n          background\n          @size-change=\"sizeChange\"\n          @current-change=\"currentChange\"\n          :current-page=\"page.currentPage\"\n          :page-sizes=\"[10, 20, 30, 40, 50, 100]\"\n          :page-size=\"page.pageSize\"\n          layout=\"total, sizes, prev, pager, next, jumper\"\n          :total=\"page.total\"\n        >\n        </el-pagination>\n      </el-row>\n      <el-dialog\n        title=\"数据导入\"\n        append-to-body\n        :visible.sync=\"excelBox\"\n        width=\"555px\"\n      >\n        <avue-form\n          :option=\"excelOption\"\n          v-model=\"excelForm\"\n          :upload-after=\"uploadAfter\"\n        >\n          <template slot=\"excelTemplate\">\n            <el-button type=\"primary\" @click=\"handleTemplate\">\n              点击下载<i class=\"el-icon-download el-icon--right\"></i>\n            </el-button>\n          </template>\n        </avue-form>\n      </el-dialog>\n      <!-- 表单模块 -->\n      <el-dialog\n        :title=\"title\"\n        :visible.sync=\"box\"\n        width=\"50%\"\n        :before-close=\"beforeClose\"\n        append-to-body\n      >\n        <el-form\n          :disabled=\"view\"\n          :size=\"option.size\"\n          ref=\"form\"\n          :model=\"form\"\n          label-width=\"80px\"\n        >\n          <el-row>\n            <el-col span=\"12\">\n              <el-form-item label=\"提报日期\" prop=\"submissionDate\">\n                <el-date-picker\n                  v-model=\"form.submissionDate\"\n                  format=\"yyyy-MM-dd\"\n                  value-format=\"yyyy-MM-dd\"\n                  type=\"date\"\n                  placeholder=\"选择日期\"\n                ></el-date-picker>\n              </el-form-item>\n            </el-col>\n            <el-col span=\"12\">\n              <el-form-item label=\"产商\" prop=\"business\">\n                <el-input v-model=\"form.business\" placeholder=\"请输入产商\" />\n              </el-form-item>\n            </el-col>\n          </el-row>\n          <el-row>\n            <el-col span=\"12\">\n              <el-form-item label=\"商品条码\" prop=\"business\">\n                <el-input v-model=\"form.goodsCode\" placeholder=\"请输入条码\" />\n              </el-form-item>\n            </el-col>\n            <el-col span=\"12\">\n              <el-form-item label=\"进度\" prop=\"business\">\n                <el-select\n                  v-model=\"form.goodsRate\"\n                  clearable\n                  placeholder=\"请选择\"\n                >\n                  <el-option\n                    v-for=\"item in rateOptions\"\n                    :key=\"item.value\"\n                    :label=\"item.label\"\n                    :value=\"item.value\"\n                  >\n                  </el-option>\n                </el-select>\n              </el-form-item>\n            </el-col>\n          </el-row>\n          <el-row>\n            <el-col span=\"12\">\n              <el-form-item label=\"商品名称\" prop=\"goodsName\">\n                <el-input\n                  v-model=\"form.goodsName\"\n                  placeholder=\"请输入商品名称\"\n                />\n              </el-form-item>\n            </el-col>\n            <el-col span=\"8\">\n              <el-form-item label=\"商品Sku\" prop=\"goodsColor\">\n                <el-input\n                  v-model=\"form.goodsColor\"\n                  placeholder=\"请输入商品Sku\"\n                />\n              </el-form-item>\n            </el-col>\n          </el-row>\n          <el-row>\n            <el-col span=\"8\">\n              <el-form-item label=\"商品尺寸\" prop=\"goodsSize\">\n                <el-input\n                  v-model=\"form.goodsSize\"\n                  placeholder=\"请输入商品尺寸\"\n                />\n              </el-form-item>\n            </el-col>\n            <el-col span=\"8\">\n              <el-form-item label=\"克重\" prop=\"goodsWeightK\">\n                <el-input\n                  v-model=\"form.goodsWeightK\"\n                  placeholder=\"请输入克重\"\n                />\n              </el-form-item>\n            </el-col>\n            <el-col span=\"8\">\n              <el-form-item label=\"包装\" prop=\"pack\">\n                <!-- <el-input v-model=\"form.pack\" placeholder=\"请输入包装\" /> -->\n                <el-select v-model=\"form.pack\" clearable placeholder=\"请选择\">\n                  <el-option key=\"有\" label=\"有\" value=\"有\"> </el-option>\n                  <el-option key=\"无\" label=\"无\" value=\"无\"> </el-option>\n                </el-select>\n              </el-form-item>\n            </el-col>\n          </el-row>\n          <el-row>\n            <el-col span=\"8\">\n              <el-form-item label=\"商品进价\" prop=\"buyingPrice\">\n                <el-input\n                  v-model=\"form.buyingPrice\"\n                  placeholder=\"请输入商品进价\"\n                />\n              </el-form-item>\n            </el-col>\n            <el-col span=\"8\">\n              <el-form-item label=\"发货地\" prop=\"placeDeliver\">\n                <el-input\n                  v-model=\"form.placeDeliver\"\n                  placeholder=\"请输入发货地\"\n                />\n              </el-form-item>\n            </el-col>\n            <el-col span=\"8\">\n              <el-form-item label=\"利润率\" prop=\"profitRate\">\n                <el-input\n                  v-model=\"form.profitRate\"\n                  placeholder=\"请输入利润率\"\n                />\n              </el-form-item>\n            </el-col>\n          </el-row>\n          <el-form-item label=\"审核\" prop=\"auditing\">\n            <!-- <el-input v-model=\"form.auditing\" placeholder=\"请输入审核\"/> -->\n            <el-switch\n              v-model=\"form.auditing\"\n              active-value=\"Y\"\n              inactive-value=\" \"\n            >\n            </el-switch>\n          </el-form-item>\n          <el-form-item label=\"保留表单\" prop=\"auditing\">\n            <!-- <el-input v-model=\"form.auditing\" placeholder=\"请输入审核\"/> -->\n            <el-switch\n              v-model=\"form.isSave\"\n            >\n            </el-switch>\n          </el-form-item>\n        </el-form>\n        <!-- 表单按钮 -->\n        <span v-if=\"!view\" slot=\"footer\" class=\"dialog-footer\">\n          <el-button\n            type=\"primary\"\n            icon=\"el-icon-circle-check\"\n            :size=\"option.size\"\n            @click=\"handleSubmit\"\n            >提 交</el-button\n          >\n          <el-button\n            icon=\"el-icon-circle-close\"\n            :size=\"option.size\"\n            @click=\"box = false\"\n            >取 消</el-button\n          >\n        </span>\n      </el-dialog>\n      <!-- 算价模块 -->\n      <el-dialog\n        v-loading=\"loadingDialog\"\n        :title=\"title\"\n        :visible.sync=\"priceBox\"\n        width=\"50%\"\n        :before-close=\"beforeClose\"\n        append-to-body\n      >\n        <el-form\n          :size=\"option.size\"\n          ref=\"priceForm\"\n          :model=\"priceForm\"\n          label-width=\"80px\"\n        >\n          <el-row>\n            <el-col span=\"8\">\n              <el-form-item label=\"数量\" prop=\"goodsCount\">\n                <el-input\n                  v-model=\"priceForm.goodsCount\"\n                  placeholder=\"请输入数量\"\n                />\n              </el-form-item>\n            </el-col>\n            <el-col span=\"8\">\n              <el-form-item label=\"重量\" prop=\"goodsCount\">\n                <el-input\n                  v-model=\"priceForm.weight\"\n                  placeholder=\"请输入\"\n                  disabled\n                />\n              </el-form-item>\n            </el-col>\n          </el-row>\n          <el-row>\n            <el-col span=\"12\">\n              <el-form-item label=\"嘉兴收\" prop=\"city1\">\n                <!-- <el-cascader\n                  clearable\n                  :props=\"propsCity1\"\n                  :options=\"cityList\"\n                  v-model=\"priceForm.city1\"\n                  @change=\"changeCity1\"\n                ></el-cascader> -->\n                <el-select\n                clearable\n                  v-model=\"priceForm.city1\"\n                  filterable\n                  remote\n                  reserve-keyword\n                  @change=\"changeCity1\"\n                  placeholder=\"请输入关键词\"\n                  :remote-method=\"remoteMethod\"\n                >\n                  <el-option\n                    v-for=\"item in cityList\"\n                    :key=\"item.code\"\n                    :label=\"item.name\"\n                    :value=\"item.code\"\n                  >\n                  </el-option>\n                </el-select>\n              </el-form-item>\n            </el-col>\n            <el-col span=\"12\">\n              <el-form-item label=\"嘉兴发\" prop=\"city2\">\n                <!-- <el-cascader\n                  clearable\n                  :props=\"propsCity1\"\n                  :options=\"cityList\"\n                  v-model=\"priceForm.city2\"\n                  @change=\"changeCity1\"\n                ></el-cascader> -->\n                <el-select\n                  clearable\n                  v-model=\"priceForm.city2\"\n                  filterable\n                  remote\n                  reserve-keyword\n                  @change=\"changeCity2\"\n                  placeholder=\"请输入关键词\"\n                  :remote-method=\"remoteMethod\"\n                >\n                  <el-option\n                    v-for=\"item in cityList\"\n                    :key=\"item.code\"\n                    :label=\"item.name\"\n                    :value=\"item.code\"\n                  >\n                  </el-option>\n                </el-select>\n              </el-form-item>\n            </el-col>\n            <el-col span=\"12\">\n              <el-form-item label=\"运费1:\" prop=\"city1\">\n                {{ this.request.freightFee1 }}\n              </el-form-item>\n            </el-col>\n            <el-col span=\"12\">\n              <el-form-item label=\"成本1:\" prop=\"city1\">\n                {{ this.request.primeCost1 }}\n              </el-form-item>\n            </el-col>\n            <el-col span=\"12\">\n              <el-form-item label=\"运费2:\" prop=\"city1\">\n                {{ this.request.freightFee2 }}\n              </el-form-item>\n            </el-col>\n            <el-col span=\"12\">\n              <el-form-item label=\"成本2:\" prop=\"city1\">\n                {{ this.request.primeCost2 }}\n              </el-form-item>\n            </el-col>\n          </el-row>\n        </el-form>\n        <span slot=\"footer\" class=\"dialog-footer\">\n          <el-button type=\"primary\" :size=\"option.size\" @click=\"handleComputed\"\n            >计 算</el-button\n          >\n          <el-button\n            type=\"primary\"\n            icon=\"el-icon-circle-check\"\n            :size=\"option.size\"\n            @click=\"handleSavePrice\"\n            >保 存</el-button\n          >\n          <el-button\n            icon=\"el-icon-circle-close\"\n            :size=\"option.size\"\n            @click=\"priceBox = false\"\n            >取 消</el-button\n          >\n        </span>\n      </el-dialog>\n    </div>\n  </basic-container>\n</template>\n\n<script>\nimport {\n  getList,\n  getDetail,\n  add,\n  update,\n  remove,\n} from \"@/api/goodsInfo/goodsInfo\";\n// import request from \"@/router/axios\";\nimport option from \"@/const/goodsInfo/goodsInfo\";\nimport focusInput from \"@/components/focus-input/main.vue\";\nimport request from \"@/router/axios\";\nimport { mapGetters } from \"vuex\";\nimport store from \"../../store\";\nimport { exportBlob } from \"@/api/common\";\nimport { downloadXls, timeFormate } from \"@/util/util\";\nimport { getToken } from \"@/util/auth\";\nimport NProgress from \"nprogress\";\nimport \"nprogress/nprogress.css\";\n\nexport default {\n  components: {\n    \"focus-input\": focusInput,\n  },\n  data() {\n    return {\n      request: {},\n      propsCity1: {\n        lazy: true,\n        value: \"key\",\n        label: \"title\",\n        lazyLoad: this.loadCity,\n      },\n      bindId: \"\",\n      cityList: [],\n      excelBox: false,\n      rateOptions: [\n        {\n          value: \"寻源中\",\n          label: \"寻源中\",\n          color: \"#fab132\",\n        },\n        {\n          value: \"有价格\",\n          label: \"有价格\",\n          color: \"#f5eb3f\",\n        },\n        {\n          value: \"有样品\",\n          label: \"有样品\",\n          color: \"#bdd86e\",\n        },\n\n        {\n          value: \"有完整图片\",\n          label: \"有完整图片\",\n          color: \"#8ec974\",\n        },\n        {\n          value: \"供货中\",\n          label: \"供货中\",\n          color: \"#78b3b0\",\n        },\n        {\n          value: \"返单中\",\n          label: \"返单中\",\n          color: \"#17abe1\",\n        },\n        {\n          value: \"销售中\",\n          label: \"销售中\",\n          color: \"#74d1ee\",\n        },\n        {\n          value: \"回本期\",\n          label: \"回本期\",\n          color: \"#806eaf\",\n        },\n        {\n          value: \"盈利期\",\n          label: \"盈利期\",\n          color: \"#fb66a8\",\n        },\n        {\n          value: \"审核未通过\",\n          label: \"审核未通过\",\n          color: \"#fc7717\",\n        },\n      ],\n      excelForm: {},\n      excelOption: {\n        submitBtn: false,\n        emptyBtn: false,\n        column: [\n          {\n            label: \"模板上传\",\n            prop: \"excelFile\",\n            type: \"upload\",\n            drag: true,\n            loadText: \"模板上传中，请稍等\",\n            span: 24,\n            propsHttp: {\n              res: \"data\",\n            },\n            tip: \"请上传 .xls,.xlsx 标准格式文件\",\n            action: \"/api/blade-goodsInfo/goodsInfo/import-goodsInfo\",\n          },\n          {\n            label: \"数据覆盖\",\n            prop: \"isCovered\",\n            type: \"switch\",\n            align: \"center\",\n            width: 80,\n            dicData: [\n              {\n                label: \"否\",\n                value: 0,\n              },\n              {\n                label: \"是\",\n                value: 1,\n              },\n            ],\n            value: 0,\n            slot: true,\n            rules: [\n              {\n                required: true,\n                message: \"请选择是否覆盖\",\n                trigger: \"blur\",\n              },\n            ],\n          },\n          {\n            label: \"模板下载\",\n            prop: \"excelTemplate\",\n            formslot: true,\n            span: 24,\n          },\n        ],\n      },\n      // 弹框标题\n      title: \"\",\n      // 是否展示弹框\n      box: false,\n      priceBox: false,\n      // 是否显示查询\n      search: true,\n      // 加载中\n      loading: true,\n      loadingDailog: false,\n      // 是否为查看模式\n      view: false,\n      // 查询信息\n      query: {},\n      headers: {\n        \"Blade-Auth\": \"Bearer \" + store.getters.token,\n      },\n      // 分页信息\n      page: {\n        currentPage: 1,\n        pageSize: 10,\n        total: 40,\n      },\n      // 表单数据\n      form: {},\n      priceForm: {},\n      // 选择行\n      selectionList: [],\n      // 表单配置\n      option: option,\n      // 表单列表\n      data: [],\n      editCellOption: {},\n    };\n  },\n  watch: {\n    \"excelForm.isCovered\"() {\n      if (this.excelForm.isCovered !== \"\") {\n        const column = this.findObject(this.excelOption.column, \"excelFile\");\n        column.action = `/api/blade-goodsInfo/goodsInfo/import-goodsInfo?isCovered=${this.excelForm.isCovered}`;\n      }\n    },\n    \"priceForm.goodsCount\"() {\n      this.priceForm.weight =\n        (this.priceForm.goodsCount * this.priceForm.goodsWeightG) / 1000;\n    },\n  },\n  mounted() {\n    this.init();\n    this.onLoad(this.page);\n  },\n  computed: {\n    ...mapGetters([\"permission\"]),\n    ids() {\n      let ids = [];\n      this.selectionList.forEach((ele) => {\n        ids.push(ele.id);\n      });\n      return ids.join(\",\");\n    },\n  },\n  methods: {\n    init() {},\n    bind_Id(id) {\n      this.bindId = id;\n      console.log(this.bindId);\n    },\n    myFuction(fname, param) {\n      if (fname) {\n        return this[fname](param);\n      }\n    },\n    beforeUpload(file) {\n      const isLt2M = file.size / 1024 / 1024 < 1;\n\n      if (!isLt2M) {\n        this.$message.error(\"上传文件大小不能超过 1MB\");\n        return false;\n      }\n    },\n    uploadImage(params) {\n      this.loading = true;\n      let file = params.file;\n      const form = new FormData();\n\n      const imageConversion1 = require(\"image-conversion\");\n      imageConversion1.compressAccurately(file, 100).then((res) => {\n        let resFile = new File([res], file.name);\n        form.append(\"file\", resFile);\n        request({\n          url: \"/api/blade-resource/oss/endpoint/put-file-attach\",\n          method: \"post\",\n          data: form,\n        })\n          .then(({ data }) => {\n            this.imageSuccess(data);\n          })\n          .catch(() => {\n            this.loading = false;\n            this.$message({\n              message: \"上传失败，请重试\",\n              type: \"error\",\n            });\n          });\n      });\n    },\n    testclick(f, arg) {\n      console.log(this[f](arg));\n    },\n    changeCity(value) {\n      console.log(value);\n    },\n    changeInput(form) {\n      console.log(form);\n    },\n    openEdit(option) {\n      this.editCellOption = { ...option };\n      console.log(this.editCellOption);\n      option.width = option.width + 45;\n    },\n    handleOfferPrice(row) {\n      this.priceBox = true;\n      this.title = row.goodsName;\n      this.priceForm={};\n      //  let tmp = + (value.replace('%','') / 100).toFixed(2);\n      //   form = {\n      //     ...form,\n      //     'quotePrice':(row.primeCost2 * (1+tmp) ).toFixed(1)\n      //   }\n      this.priceForm = {\n        goodsId: row.id,\n        profitRate:row.profitRate,\n        goodsCount: row.goodsCount || 200,\n        goodsWeightK: row.goodsWeightK,\n        buyingPrice: row.buyingPrice,\n        weight: (row.goodsCount * row.goodsWeightK)/1000,\n      };\n      this.request = {\n        primeCost1: row.primeCost1,\n        primeCost2: row.primeCost2,\n        freightFee1: row.freightFee1,\n        freightFee2: row.freightFee2,\n      };\n    },\n    remoteMethod(query){\n      if(query){\n        this.$http({\n          url: `/api/blade-system/region/allList?name=${query}`,\n          method: \"get\",\n        }).then((res) => {\n          this.cityList = res.data.data;\n        })\n      }\n       \n    },\n    changeCity2(city2){\n      if(city2){\n        const city = this.cityList.find(item => item.code == city2)\n        this.priceForm.receiveCityId = city.code;\n        this.priceForm.receiveProvinceId = city.parentCode;\n      }\n      else {\n        this.priceForm.receiveCityId = null;\n        this.priceForm.receiveProvinceId = null;\n      }\n      \n    },\n     changeCity1(city1){\n      if(city1){\n        const city = this.cityList.find(item => item.code == city1)\n        this.priceForm.sendCityId = city.code;\n        this.priceForm.sendProvinceId = city.parentCode;\n      }\n      else{\n        this.priceForm.sendCityId = null;\n        this.priceForm.sendProvinceId = null;\n      }\n      \n    },\n    loadCity(treeNode, resolve) {\n      if (treeNode.data != null) {\n        this.$http({\n          url: `/api/blade-system/region/lazy-tree?parentCode=${treeNode.data.key}`,\n          method: \"get\",\n        }).then((res) => {\n          const nodes = res.data.data.map((iteam) => {\n            return {\n              leaf: true,\n              key: iteam.key,\n              title: iteam.title,\n            };\n          });\n          resolve(nodes);\n          console.log(treeNode);\n        });\n      } else {\n        this.loadCityBypId(\"00\", (res) => {\n          console.log(res.data.data);\n          this.cityList = res.data.data;\n        });\n      }\n    },\n    goodsRateStyle(row) {\n      const rateinfo = this.rateOptions.find(\n        (rate) => rate.value == row.goodsRate\n      );\n      if (rateinfo) {\n        return {\n          color: rateinfo.color,\n        };\n      } else return {};\n    },\n    loadCityBypId(pCode, event) {\n      this.$http({\n        url: `/api/blade-system/region/lazy-tree?parentCode=${pCode}`,\n        method: \"get\",\n      }).then(event);\n    },\n    handleComputed() {\n      console.log(this.priceForm);\n      this.loadingDailog = true;\n      // const form = {\n      //   goodsCount: this.priceForm.goodsCount,\n      //   weight: this.priceForm.weight,\n      //   buyingPrice: this.priceForm.buyingPrice,\n      //   sendProvinceId: this.priceForm.sendProvinceId,\n      //   sendCityId: this.priceForm.sendCityId ,\n      //   receiveProvinceId: this.priceForm.city2\n      //     ? this.priceForm.city2[0]\n      //     : null,\n      //   receiveCityId: this.priceForm.city2 ? this.priceForm.city2[1] : null,\n      // };\n      this.$http({\n        url: `/api/blade-goodsInfo/goodsInfo/computedPrice`,\n        params: this.priceForm,\n      }).then((res) => {\n        this.loadingDailog = false;\n        console.log(res);\n        this.request = res.data.data;\n      });\n    },\n    uploadAfter(res, done, loading, column) {\n      window.console.log(column);\n      this.excelBox = false;\n      this.onLoad(this.page);\n      done();\n    },\n    handleExport() {\n      this.$confirm(\"是否导出商品信息数据?\", \"提示\", {\n        confirmButtonText: \"确定\",\n        cancelButtonText: \"取消\",\n        type: \"warning\",\n      }).then(() => {\n        NProgress.start();\n        exportBlob(\n          `/api/blade-goodsInfo/goodsInfo/export-goodsInfo?${\n            this.website.tokenHeader\n          }=${getToken()}`,\n          this.query\n        ).then((res) => {\n          downloadXls(res.data, `商品信息${timeFormate(new Date())}.xlsx`);\n          NProgress.done();\n        });\n      });\n    },\n    handleSort({ prop, order }) {\n      this.$delete(this.query, \"descs\");\n      this.$delete(this.query, \"ascs\");\n      const orderS = order == \"descending\" ? \"descs\" : \"ascs\";\n      if (order) {\n        prop = prop.replace(/([A-Z])/g, \"_$1\").toLowerCase();\n        this.query = {\n          ...this.query,\n          [orderS]: prop,\n        };\n      }\n      this.onLoad(this.page);\n    },\n    searchHide() {\n      this.search = !this.search;\n    },\n    searchChange() {\n      this.onLoad(this.page);\n    },\n    searchReset() {\n      this.query = {};\n      this.page.currentPage = 1;\n      this.onLoad(this.page);\n    },\n    handleSubmit() {\n      this.form.auditing = this.form.auditing?this.form.auditing.trim():'';\n      if (!this.form.id) {\n        add(this.form).then(() => {\n          this.box = false;\n          this.onLoad(this.page);\n          this.$message({\n            type: \"success\",\n            message: \"操作成功!\",\n          });\n        });\n      } else {\n        update(this.form).then(() => {\n          this.box = false;\n          this.onLoad(this.page);\n          this.$message({\n            type: \"success\",\n            message: \"操作成功!\",\n          });\n        });\n      }\n    },\n    handleSavePrice() {\n      if (!this.request.primeCost1) {\n        this.$message({\n          type: \"error\",\n          message: \"请先计算费用!\",\n        });\n      }\n       let tmp = + (this.priceForm.profitRate.replace('%','') / 100).toFixed(2);\n      const form = {\n        id: this.priceForm.goodsId,\n        goodsCount: this.priceForm.goodsCount,\n        goodsWeightKg: this.priceForm.goodsWeightKg,\n        offerPrice: (this.request.primeCost2* (1+tmp) ).toFixed(1),\n        ...this.request,\n      };\n      update(form).then(() => {\n        this.priceBox = false;\n        this.onLoad(this.page);\n        this.$message({\n          type: \"success\",\n          message: \"操作成功!\",\n        });\n      });\n    },\n    handleTemplate() {\n      exportBlob(\n        `/api/blade-goodsInfo/goodsInfo/export-template?${\n          this.website.tokenHeader\n        }=${getToken()}`\n      ).then((res) => {\n        downloadXls(res.data, `商品信息模板.xlsx`);\n      });\n    },\n    handleImport() {\n      this.excelBox = true;\n    },\n    handleAdd() {\n      this.title = \"新增\";\n      if(!this.form.isSave){\n        this.form = {\n        submissionDate:new Date()\n        };\n      }\n      this.box = true;\n    },\n    handleEdit(row) {\n      this.title = \"编辑\";\n      this.box = true;\n      getDetail(row.id).then((res) => {\n        this.form = res.data.data;\n      });\n    },\n    handleView(row) {\n      this.title = \"查看\";\n      this.view = true;\n      this.box = true;\n      getDetail(row.id).then((res) => {\n        this.form = res.data.data;\n      });\n    },\n    handleDelete() {\n      if (this.selectionList.length === 0) {\n        this.$message.warning(\"请选择至少一条数据\");\n        return;\n      }\n      this.$confirm(\"确定将选择数据删除?\", {\n        confirmButtonText: \"确定\",\n        cancelButtonText: \"取消\",\n        type: \"warning\",\n      })\n        .then(() => {\n          return remove(this.ids);\n        })\n        .then(() => {\n          this.selectionClear();\n          this.onLoad(this.page);\n          this.$message({\n            type: \"success\",\n            message: \"操作成功!\",\n          });\n        });\n    },\n    rowDel(row) {\n      this.$confirm(\"确定将选择数据删除?\", {\n        confirmButtonText: \"确定\",\n        cancelButtonText: \"取消\",\n        type: \"warning\",\n      })\n        .then(() => {\n          return remove(row.id);\n        })\n        .then(() => {\n          this.onLoad(this.page);\n          this.$message({\n            type: \"success\",\n            message: \"操作成功!\",\n          });\n        });\n    },\n    tableRowStyle({ rowIndex }) {\n      if (rowIndex % 2 != 0) {\n        return {\n          \"background-color\": \"#f6f6f6\",\n        };\n      }\n    },\n    handleOnBlur(row, item, value, isChange) {\n      \n      let form = {\n        id:row.id,\n        [item.prop]: value,\n      };\n      if(item.prop == 'profitRate' && value){\n        let tmp = + (value.replace('%','') / 100).toFixed(2);\n        form = {\n          ...form,\n          offerPrice:(row.primeCost2 * (1+tmp) ).toFixed(1)\n        }\n      }\n      item.width = this.editCellOption.width;\n      if (isChange) {\n        this.loading = true;\n        update(form).then(() => {\n          this.onLoad(this.page);\n          this.editCellOption = {};\n          this.$message({\n            type: \"success\",\n            message: \"更新成功!\",\n          });\n        });\n      }\n    },\n    beforeClose(done) {\n      done();\n      this.request = {};\n      this.priceForm = {};\n      this.view = false;\n    },\n    copySuccess() {\n      this.$message({\n        message: \"复制成功\",\n        type: \"success\",\n      });\n    },\n    selectionChange(list) {\n      this.selectionList = list;\n    },\n    selectionClear() {\n      this.selectionList = [];\n      this.$refs.table.clearSelection();\n    },\n    currentChange(currentPage) {\n      this.page.currentPage = currentPage;\n      this.onLoad(this.page);\n    },\n    sizeChange(pageSize) {\n      this.page.pageSize = pageSize;\n      this.onLoad(this.page);\n    },\n    imageSuccess(res) {\n      console.log(res);\n      // this.onLoad(this.page);\n      const form = {\n        goodsImage: res.data.link,\n        id: this.bindId,\n      };\n      update(form)\n        .then(() => {\n          this.loading = false;\n          this.onLoad(this.page);\n          this.$message({\n            type: \"success\",\n            message: \"操作成功!\",\n          });\n        })\n        .catch(() => {\n          this.loading = false;\n        });\n    },\n    onLoad(page, params = {}) {\n      this.loading = true;\n      getList(\n        page.currentPage,\n        page.pageSize,\n        Object.assign(params, this.query)\n      ).then((res) => {\n        const data = res.data.data;\n        this.page.total = data.total;\n        this.data = data.records;\n        this.loading = false;\n        this.selectionClear();\n      });\n    },\n  },\n};\n</script>\n\n<style lang=\"scss\" scoped>\n.el-pagination {\n  margin-top: 20px;\n}\n.avatar-uploader .el-upload {\n  border: 1px dashed #d9d9d9;\n  border-radius: 6px;\n  cursor: pointer;\n  position: relative;\n  overflow: hidden;\n}\n.avatar-uploader .el-upload:hover {\n  border-color: #409eff;\n}\n.avatar-uploader-icon {\n  font-size: 28px;\n  color: #8c939d;\n  text-align: center;\n}\n.avatar {\n  display: block;\n}\n</style>\n"]}]}